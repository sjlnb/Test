---
title: 普中DSPTMS320F28335（一）
date: 2023-05-29 11:17:08
tags:
---

# 一、TMS320F28335介绍

* DMA直接进行数据传输，CPU只执行功能
* 一个周期内完成32*32位的乘法累加运算
* 主要应用于DSC场景

	## 处理器资源

* 32位浮点DSP
* 片上存储：FLASH（程序）、SRAM（中间变量）、BOOT ROM（BootLoader）、OPT ROM（一次性编程存储空间）
* 片上外设：PWM、HRPWM、CAP、QEP、ADC、SCI、MCBPS、CAN、SPI、I2C、XINTF（外部存储器扩展接口）、GPIO

## 芯片型号

* TMS：合格设备
* 320：TMS320，DSP系列
* F：FLASH EPROM，工艺
* 28335：C2x，设备类型
* PGF：176脚QFP，封装类型
* A：40~85℃，温度范围

## 引脚分布

* JTAG：（TDI、TDO、TMS、TRS）烧录与调试，烧入RAM调试，烧入Flash运行
* 时钟：30M外部晶振，倍频至150M
* 复位：低电平复位
* 电源：（V~），外设供电3.3V与内核供电1.9V不同
* ADC：16路，每个引脚2路
* GPIO与其他：复用功能

## 芯片用途

* ePWM强大，用于自动化控制领域的电机控制、伺服控制，尤其是电机、电源、逆变器
* 测量仪器、家用、通信（SCI串口、CAN用于与外部设备通信，SPI）、军事领域

## 学习流程

* GPIO、INT、TIMER、SCI

* SPI、IIC、eCAN、ePWM、ADC、MCBSP、eCAP、eQEP
* uCOS（操作系统）、 FatFS（操作SD卡，文件系统）、MATLAB（与外部仪器进行通信）



# 二、最小系统

## 组成电路

* 电源
  * 通过电源转换芯片转换不同电压值、模拟电压与数字电压隔离
* 复位
  * 开机时电容未充满电会导致复位引脚低电平，从而复位
  * 烧录时不能按复位，否则导致芯片锁死
* 晶振
  * 晶振两端接22pF电容，电容另一端接地
* 下载
  * 通过JTAG进行下载烧录

## 启动模式

​	XA1x引脚进行Boot启动，每个引脚有两种模式，共16种启动模式



# 三、Code Composer Studio 软件

## 获取与安装

* 获取：TI官网、开发光盘
* 避免安装错误：路径不能带中文
* 安装路径建议默认，Select All

## 仿真器驱动安装

* 设备管理器显示TI XDS Channel

## 工程导入与程序下载

* 设置工作空间路径
* 工程文件夹名不能出现中文与特殊符号
* 工作空间内已导入的工程与将要导入的工程不能相同
* 硬件连接：仿真器连接开发板、开发板供电、仿真器连接PC端、Connect
* Build编译、Debug仿真调试
* Target Configuration
  * .ccxml文件中选择仿真器型号、芯片类型
  * 测试仿真器与开发板是否连接成功：...has succeeded

# 四、存储器与寄存器

## 存储器映射 

* 存储器映射
  * 指存储器地址由芯片厂商分配
  * 重映射：存储器映射后再次分配地址
  * F28335的重映射采用统一寻址的方式（程序、数据和I/O统一寻址）
    * 提高空间利用率
    * 方便程序开发
  * 多级流水线的增强哈佛总线结构，并行访问程序和数据存储空间 
    * 连续编址
    * 地址唯一

<img src="D:\学习资料\Git\MyBlog\source\image\存储器映射图.png" alt="存储器映射图" style="zoom:80%;" />

两个字节对应一个单元，一个单元对应一个地址

16B：0x00~0x40

2KB：0x400~0x800

PFx：片上外设空间，受保护

128位密码，代码安全模块CSM：

 * 保护程序代码、SRAM数据
 * 位于Flash空间
 * 通过密码匹配解锁器件，密码为0时无法解密

双映射空间：地址不同，有利于数据备份

## 寄存器映射

* 给内存地址取别名
  * 通过#pragma预处理命令、DATA SECTION 将定义的寄存器指向对应的存储单元内，之后通过C语言操作寄存器
  * `#`pragma DATA_SECTION（GpioCtrlRegs， “GpioCtrlRegsFile”）；
  * GpioDataRegs.GPCCLEAR.bit.GPIO68 = 1;
* 通过芯片数据手册查找单元地址所对应的寄存器功能





